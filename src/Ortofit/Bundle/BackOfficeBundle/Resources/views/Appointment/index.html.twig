{% extends 'OrtofitBackOfficeBundle:Layout:layout.html.twig' %}
{% block body %}
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            Главная
        </h1>
        <ol class="breadcrumb">
            <li><a href="#"><i class="fa fa-dashboard"></i>Главная</a></li>
        </ol>
    </section>


    <!-- content -->
    <section class="content">
        <div class="row">
            <div class="col-md-12">
                <ul id="office_tabs" class="nav nav-tabs" data-tabs="tabs">
                    {% for office in offices %}
                        {% if office.id == activeOfficeId %}
                            <li class="active"><a href="#" data-toggle="tab" class="office_link" office-id="{{ office.id }}">{{ office.name }}</a></li>
                        {% else %}
                            <li><a href="#" data-toggle="tab" class="office_link" office-id="{{ office.id }}">{{ office.name }}</a></li>
                        {% endif %}
                    {% endfor %}
                </ul>
                <div class="box box-primary">
                    <div class="box-body no-padding">
                        <!-- THE CALENDAR -->
                        {% for office in offices %}
                            {% if office.id == activeOfficeId %}
                                <div id="calendar{{ office.id }}"></div>
                            {% else %}
                                <div id="calendar{{ office.id }}" class="hidden"></div>
                            {% endif  %}
                        {% endfor %}
                    </div><!-- /.box-body -->
                </div><!-- /. box -->
            </div><!-- /.col -->
        </div><!-- /.row -->
    </section><!-- /.content -->

    <script>
        $(function () {
            var officeIds = [];
            {% for office in offices %}
            officeIds.push({{ office.id }});
            $('#calendar{{ office.id }}').fullCalendar({
                header: {
                    left:   'prev,next today',
                    center: 'title',
                    right:  'month,agendaWeek,agendaDay'
                },
                buttonText: {
                    today: 'сегодня',
                    month: 'месяц',
                    week:  'неделя',
                    day:   'день'
                },
                businessHours: {
                    start: '08:00',
                    end:   '20:00'
                },
               // lang: 'ru',
                events: '{{ url('backendoffice_appointment_get_app') }}?office_id={{ office.id }}',
                //Random default events
                editable: true,
                droppable: true, // this allows things to be dropped onto the calendar !!!
                eventClick: function(calEvent, jsEvent, view) {

                    alert('Event: ' + calEvent.id);
                    // change the border color just for fun
                    // $(this).css('border-color', 'red');

                }

            });
            {% endfor %}

            $('.office_link').click(function(){
                var officeId = $(this).attr('office-id');
                var calendarId = null;
                for (var i=0; i<officeIds.length; i++ ) {
                    calendarId = '#calendar' + officeIds[i];
                    console.log(calendarId);
                    console.log(i);
                    console.log(officeId);
                    if (officeIds[i] == officeId) {
                        $(calendarId).show();
                        $(calendarId).removeClass('hidden');
                        $(calendarId).fullCalendar('rerenderEvents');
                    } else {
                        $(calendarId).hide();
                    }
                }
            });
        });

    </script>

{% endblock %}